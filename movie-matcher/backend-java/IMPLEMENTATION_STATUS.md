# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Movie Matcher

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç `ARCHITECTURE.md`
- ‚úÖ –û–ø–∏—Å–∞–Ω—ã –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 2. Design Patterns (–û–û–ü Best Practices)

#### Strategy Pattern - –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
- ‚úÖ `VotingCompletionStrategy` (interface)
- ‚úÖ `UnanimousVotingStrategy` - 100% —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- ‚úÖ `MajorityVotingStrategy` - 70% —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

#### Adapter Pattern - –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `MovieDataSource` (interface)
- ‚úÖ `DatabaseMovieDataSource` - –ø–æ–∏—Å–∫ –≤ –ë–î

#### Chain of Responsibility - –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤
- ‚úÖ `MovieSearchHandler` (abstract)
- ‚úÖ `DatabaseSearchHandler` - –ø–æ–∏—Å–∫ –≤ –ë–î
- ‚úÖ `OmdbSearchHandler` - –ø–æ–∏—Å–∫ –≤ OMDB + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- ‚úÖ `MovieSearchService` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–æ–π

#### Transactional Outbox Pattern - –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ë–î
- ‚úÖ `EnrichmentQueueItem` (entity)
- ‚úÖ `EnrichmentService` —Å scheduled –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- ‚úÖ Retry mechanism –∏ idempotency

### 3. Rich Domain Model (DDD)

#### Aggregate Root
- ‚úÖ `RoomAggregate` - –≥–ª–∞–≤–Ω—ã–π aggregate —Å –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º (WAITING ‚Üí VOTING ‚Üí COMPLETED)
  - –ó–∞—â–∏—Ç–∞ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–Ω–µ–ª—å–∑—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

#### Entities
- ‚úÖ `Participant` - —É—á–∞—Å—Ç–Ω–∏–∫ –∫–æ–º–Ω–∞—Ç—ã
  - –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –ø–æ–¥–±–æ—Ä–∞
  - –í—Ä—É—á–Ω—É—é –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã
  - –õ–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏
  - –°—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
  
- ‚úÖ `VotingSession` - —Å–µ—Å—Å–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
  - **–ö—Ä—É–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤**
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—Ä—É—á–Ω—É—é –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤
  - –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–ª—å–º–æ–≤ (–Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

#### Value Objects
- ‚úÖ `MovieFilters` - immutable —Ñ–∏–ª—å—Ç—Ä—ã
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
  - –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  - Builder pattern

- ‚úÖ `RoomState` - enum —Å–æ—Å—Ç–æ—è–Ω–∏–π
- ‚úÖ `VotingCompletionType` - enum —Ç–∏–ø–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### 4. Infrastructure Layer

#### Persistence
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `MovieRepository`
  - –ú–µ—Ç–æ–¥ `findByFilters` —Å **RANDOM —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π**
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–∂–∞–Ω—Ä, –≥–æ–¥, —Ä–µ–π—Ç–∏–Ω–≥, —Ç–∏–ø)
  - Criteria API –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### Mappers
- ‚úÖ `OmdbMovieMapper` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è OMDB ‚Üí Movie entity

### 5. Application Services
- ‚úÖ `MovieSearchService` - –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ `EnrichmentService` - –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –ë–î

## üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ / TODO

### 1. TMDB API Integration
- ‚è≥ `TmdbRestClient` - REST –∫–ª–∏–µ–Ω—Ç
- ‚è≥ `TmdbApiDataSource` - –∞–¥–∞–ø—Ç–µ—Ä
- ‚è≥ `TmdbSearchHandler` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ —Ü–µ–ø–æ—á–∫–µ
- ‚è≥ `TmdbMovieMapper` - –º–∞–ø–ø–µ—Ä

### 2. Application Services
- ‚è≥ `RoomApplicationService` - facade –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏
- ‚è≥ `MovieSelectionService` - –ø–æ–¥–±–æ—Ä —Ñ–∏–ª—å–º–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º

### 3. Presentation Layer
- ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å `RoomResource` (REST API)
- ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å `RoomWebSocket` —Å –Ω–æ–≤—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
- ‚è≥ DTO –¥–ª—è –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–±—ã—Ç–∏–π

### 4. Database Migrations
- ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
  - `title_ru` VARCHAR(500)
  - `plot_ru` TEXT
- ‚è≥ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è `enrichment_queue` —Ç–∞–±–ª–∏—Ü—ã
- ‚è≥ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 5. Frontend (Flutter)
- ‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Flutter –ø—Ä–æ–µ–∫—Ç–∞ –≤ `frontend-smartphone/`
- ‚è≥ –î–∏–∑–∞–π–Ω –≤ —Å—Ç–∏–ª–µ Telegram/Instagram
- ‚è≥ Swipe –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑ –¥–ª—è –ª–∞–π–∫–∞/–¥–∏–∑–ª–∞–π–∫–∞ (Tinder-style)
- ‚è≥ QR code –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚è≥ WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ö—Ä—É–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
```
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–∫–∞–∑–∞ —Ñ–∏–ª—å–º–æ–≤:
1. –í—Ä—É—á–Ω—É—é –≤—ã–±—Ä–∞–Ω–Ω—ã–µ (–≤—Å–µ –ø–æ–¥—Ä—è–¥)
2. –ò–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ–º: User1 ‚Üí User2 ‚Üí User1 ‚Üí User2

–†–∞—É–Ω–¥ = –ø–æ–∫–∞–∑ 1 —Ñ–∏–ª—å–º–∞ –æ—Ç –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≥–æ–ª–æ—Å–∞
```

### 2. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–ª—å–º–æ–≤
- `Set<String> shownMovieIds` –≤ `VotingSession`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
- –ù–∏–∫–∞–∫–æ–π —Ñ–∏–ª—å–º –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã

### 3. –†–∞–Ω–¥–æ–º–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–∑ –ë–î
- `ORDER BY RANDOM()` –≤ SQL –∑–∞–ø—Ä–æ—Å–µ
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —Ñ–∏–ª—å–º—ã

### 4. In-Memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–æ–º–Ω–∞—Ç
- `ConcurrentHashMap<String, RoomAggregate>`
- Auto-cleanup –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- TTL 24 —á–∞—Å–∞

### 5. –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ë–î
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Transactional Outbox
- Retry mechanism —Å exponential backoff

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **TMDB API** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
2. **Application Services** - —Å–ª–æ–π –º–µ–∂–¥—É domain –∏ presentation
3. **WebSocket Protocol** - –æ–±–Ω–æ–≤–∏—Ç—å —Å –Ω–æ–≤—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
4. **Liquibase Migrations** - —Å—Ö–µ–º–∞ –ë–î —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º
5. **Flutter App** - –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### SOLID
- ‚úÖ **Single Responsibility** - –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- ‚úÖ **Open/Closed** - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
- ‚úÖ **Liskov Substitution** - –≤—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã
- ‚úÖ **Interface Segregation** - —É–∑–∫–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- ‚úÖ **Dependency Inversion** - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π

### DDD
- ‚úÖ **Aggregate Root** - RoomAggregate –∫–∞–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- ‚úÖ **Entities** - —Å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å—é –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º
- ‚úÖ **Value Objects** - immutable –æ–±—ä–µ–∫—Ç—ã –±–µ–∑ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏
- ‚úÖ **Rich Domain Model** - –ª–æ–≥–∏–∫–∞ –≤ –º–æ–¥–µ–ª–∏, –Ω–µ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
- ‚úÖ **Invariants Protection** - –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ aggregate

### Clean Architecture
- ‚úÖ Domain Layer - –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –æ—Ç frameworks
- ‚úÖ Application Layer - use cases
- ‚úÖ Infrastructure Layer - –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ Presentation Layer - UI/API
